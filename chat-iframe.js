try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ecb29219-dd80-4dfd-9c01-e68d3e7f3e6d",e._sentryDebugIdIdentifier="sentry-dbid-ecb29219-dd80-4dfd-9c01-e68d3e7f3e6d")}catch(e){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"25.11.20-edge"},(()=>{"use strict";var e,t={135:(e,t,n)=>{n.d(t,{E$:()=>o}),parseInt("28",10);const o="WARN"}},n={};function o(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,o),r.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),function(e){e.DEBUG="DEBUG",e.ERROR="ERROR",e.INFO="INFO",e.WARN="WARN",e.VERBOSE="VERBOSE",e.NONE="NONE"}(e||(e={}));const s={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class r{constructor(t,n=e.WARN){this.name=t,this.level=n,this._pluggables=[]}_padding(e){return e<10?"0"+e:""+e}_ts(){const e=new Date;return[this._padding(e.getMinutes()),this._padding(e.getSeconds())].join(":")+"."+e.getMilliseconds()}configure(e){return e?(this._config=e,this._config):this._config}_log(t,...n){let o=this.level;if(r.LOG_LEVEL&&(o=r.LOG_LEVEL),"undefined"!=typeof window&&window.LOG_LEVEL&&(o=window.LOG_LEVEL),!(s[t]>=s[o]))return;let i=console.log.bind(console);t===e.ERROR&&console.error&&(i=console.error.bind(console)),t===e.WARN&&console.warn&&(i=console.warn.bind(console)),r.BIND_ALL_LOG_LEVELS&&(t===e.INFO&&console.info&&(i=console.info.bind(console)),t===e.DEBUG&&console.debug&&(i=console.debug.bind(console)));const a=`[${t}] ${this._ts()} ${this.name}`;let d="";if(1===n.length&&"string"==typeof n[0])d=`${a} - ${n[0]}`,i(d);else if(1===n.length)d=`${a} ${n[0]}`,i(a,n[0]);else if("string"==typeof n[0]){let e=n.slice(1);1===e.length&&(e=e[0]),d=`${a} - ${n[0]} ${e}`,i(`${a} - ${n[0]}`,e)}else d=`${a} ${n}`,i(a,n);for(const e of this._pluggables){const t={message:d,timestamp:Date.now()};e.pushLogs([t])}}log(...t){this._log(e.INFO,...t)}info(...t){this._log(e.INFO,...t)}warn(...t){this._log(e.WARN,...t)}error(...t){this._log(e.ERROR,...t)}debug(...t){this._log(e.DEBUG,...t)}verbose(...t){this._log(e.VERBOSE,...t)}addPluggable(e){e&&"Logging"===e.getCategoryName()&&(this._pluggables.push(e),e.configure(this._config))}listPluggables(){return this._pluggables}}r.LOG_LEVEL=null,r.BIND_ALL_LOG_LEVELS=!1;var i=o(135);const a="PP_CHATKIT";r.LOG_LEVEL=i.E$;const d=new r("ChatIframe"),l=(()=>{try{return new URL(document.referrer).origin}catch{return"*"}})();function c(e){window.parent.postMessage(e,l)}function g(e){if(!e||"object"!=typeof e)return!1;const t=e;return t.ns===a&&"string"==typeof t.cmd}let f;function p(){const e=document.getElementById("pp-chat");if(!e)throw new Error('<openai-chatkit id="pp-chat"> introuvable');return e}async function u(e,t={}){const n=Math.random().toString(36).slice(2);d.debug("Requesting auth token from parent for fetch:",{url:e,options:t,reqId:n}),c({ns:a,type:"REQUEST_AUTH_TOKEN",reqId:n});const o=await new Promise(e=>{const t=o=>{"*"!==l&&o.origin!==l||g(o.data)&&"AUTH_TOKEN_RESULT"===o.data.cmd&&o.data.reqId===n&&(window.removeEventListener("message",t),e({token:o.data.token,expiresAt:o.data.expiresAt}))};window.addEventListener("message",t)});d.debug("Received auth token from parent for fetch:",o);const s=new Headers(t.headers);o.token&&!s.has("Authorization")&&s.set("Authorization",`Bearer ${o.token}`);const r=(t.method||"GET").toUpperCase();let i=t.body;if(f&&("POST"===r||"PUT"===r||"PATCH"===r))if("string"==typeof i)try{const e=JSON.parse(i);i=JSON.stringify({...e,draftId:f})}catch{}else i instanceof FormData&&i.append("draftId",f);return fetch(e,{...t,headers:s,body:i})}window.addEventListener("message",e=>{if("*"!==l&&e.origin!==l)return;if(!g(e.data))return;const t=e.data;switch(d.debug("Received command from parent:",t),t.cmd){case"SET_OPTIONS":!function(e){try{const t=p(),n={...e,api:{...e?.api||{},fetch:u},widgets:{onAction:e=>Promise.resolve(c({ns:a,type:"CLIENT_ACTION",payload:e}))},onClientTool:({name:e,params:t})=>(c({ns:a,type:"CLIENT_TOOL",payload:{name:e,params:t}}),{})};if(t.addEventListener("chatkit.error",({detail:e})=>{d.error("ChatKit error:",e.error)}),t.addEventListener("chatkit.log",({detail:e})=>{d.debug("[chatkit]",e.name,e.data)}),"function"!=typeof t.setOptions)throw new Error("setOptions method not available on chat element");t.setOptions(n),d.debug("Chat options set via setOptions:",n),c({ns:a,type:"SET_OPTIONS_OK"})}catch(e){const t="object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message?e.message:String(e);d.error("setOptions failed",t),c({ns:a,type:"ERROR",message:`setOptions failed: ${t}`})}}(t.options);break;case"SET_THREAD":!function(e){try{const t=p();"function"==typeof t.setThreadId&&t.setThreadId(e),c({ns:a,type:"SET_THREAD_OK"})}catch(e){const t="object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message?e.message:String(e);((...e)=>{c({ns:a,type:"LOG",level:"error",args:e})})("setThread failed",t),c({ns:a,type:"ERROR",message:`setThread failed: ${t}`})}}(t.threadId??null);break;case"SET_DRAFT_ID":f=t.draftId;break;case"SET_USER_INFO":d.debug("User info received:",{userId:t.userId,userLocale:t.userLocale,darkMode:t.darkMode})}}),c({ns:a,type:"READY"}),d.info("Chat iframe initialized and READY message sent to parent")})();
//# sourceMappingURL=chat-iframe.js.map